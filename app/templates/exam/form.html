{% extends "base.html" %}

{% block title %}{% if exam %}{{ exam.name }} bearbeiten{% else %}Neue Prüfung{% endif %} - Prüfungen - Dozentenmanager{% endblock %}

{% block breadcrumb %}
<section class="section pt-4 pb-0">
    <div class="container">
        <nav class="breadcrumb" aria-label="breadcrumbs">
            <ul>
                <li><a href="{{ url_for('index') }}">Home</a></li>
                <li><a href="{{ url_for('exam.index') }}">Prüfungen</a></li>
                {% if exam %}
                <li><a href="{{ url_for('exam.show', exam_id=exam.id) }}">{{ exam.name }}</a></li>
                <li class="is-active"><a href="#" aria-current="page">Bearbeiten</a></li>
                {% else %}
                <li class="is-active"><a href="#" aria-current="page">Neue Prüfung</a></li>
                {% endif %}
            </ul>
        </nav>
    </div>
</section>
{% endblock %}

{% block content %}
<h1 class="title">
    {% if exam %}
    Prüfung bearbeiten
    {% else %}
    Neue Prüfung hinzufügen
    {% endif %}
</h1>

<div class="columns">
    <div class="column is-two-thirds">
        <div class="box">
            <form method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="field">
                    <label class="label">Name <span class="has-text-danger">*</span></label>
                    <div class="control">
                        <input
                            class="input"
                            type="text"
                            name="name"
                            placeholder="z.B. Klausur Statistik I"
                            value="{% if form_data %}{{ form_data.name }}{% elif exam %}{{ exam.name }}{% endif %}"
                            required
                            autofocus>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Lehrveranstaltung <span class="has-text-danger">*</span></label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="course_id" required>
                                <option value="">Bitte wählen...</option>
                                {% for c in courses %}
                                <option value="{{ c.id }}"
                                    {% if form_data and form_data.course_id|string == c.id|string %}selected
                                    {% elif exam and exam.course_id == c.id %}selected{% endif %}>
                                    {{ c.name }} ({{ c.semester }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <p class="help">Wählen Sie die Lehrveranstaltung aus, zu der diese Prüfung gehört</p>
                </div>

                <div class="field">
                    <label class="label">Datum <span class="has-text-danger">*</span></label>
                    <div class="control">
                        <input
                            class="input"
                            type="date"
                            name="exam_date"
                            value="{% if form_data %}{{ form_data.exam_date }}{% elif exam %}{{ exam.exam_date }}{% endif %}"
                            required>
                    </div>
                    <p class="help">Datum der Prüfung (Format: TT.MM.JJJJ)</p>
                </div>

                <div class="field">
                    <label class="label">Maximale Punkte <span class="has-text-danger">*</span></label>
                    <div class="control">
                        <input
                            class="input"
                            type="number"
                            step="0.5"
                            min="0.1"
                            name="max_points"
                            placeholder="z.B. 100"
                            value="{% if form_data %}{{ form_data.max_points }}{% elif exam %}{{ exam.max_points }}{% endif %}"
                            required>
                    </div>
                    <p class="help">Maximal erreichbare Punktzahl (muss größer als 0 sein)</p>
                </div>

                <div class="field">
                    <label class="label">Gewichtung (%) <span class="has-text-danger">*</span></label>
                    <div class="control">
                        <input
                            class="input"
                            type="number"
                            step="0.1"
                            min="0"
                            max="100"
                            name="weight"
                            placeholder="z.B. 100"
                            value="{% if form_data %}{{ form_data.weight }}{% elif exam %}{{ exam.weight }}{% else %}100{% endif %}"
                            required>
                    </div>
                    <p class="help">Prozentuale Gewichtung für die Endnote (0-100%, Standard: 100%)</p>
                </div>

                <div class="field">
                    <label class="label">Beschreibung (optional)</label>
                    <div class="control">
                        <textarea
                            class="textarea"
                            name="description"
                            placeholder="Optionale Notizen zur Prüfung"
                            rows="3">{% if form_data %}{{ form_data.description }}{% elif exam and exam.description %}{{ exam.description }}{% endif %}</textarea>
                    </div>
                    <p class="help">Zusätzliche Informationen zur Prüfung (max. 500 Zeichen)</p>
                </div>

                <div class="field is-grouped">
                    <div class="control">
                        <button type="submit" class="button is-primary">
                            <span class="icon">
                                <i class="fas fa-save"></i>
                            </span>
                            <span>{% if exam %}Aktualisieren{% else %}Erstellen{% endif %}</span>
                        </button>
                    </div>
                    <div class="control">
                        <a href="{% if exam %}{{ url_for('exam.show', exam_id=exam.id) }}{% else %}{{ url_for('exam.index') }}{% endif %}" class="button is-light">
                            <span class="icon">
                                <i class="fas fa-times"></i>
                            </span>
                            <span>Abbrechen</span>
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="column is-one-third">
        <div class="box">
            <h2 class="subtitle">Hilfe</h2>

            <div class="content">
                <h3 class="is-size-6 has-text-weight-semibold">Gewichtung</h3>
                <p>Die Gewichtung gibt an, wie stark diese Prüfung in die Endnote einfließt:</p>
                <ul>
                    <li><strong>100%</strong>: Einzige Prüfung der Veranstaltung</li>
                    <li><strong>60%</strong>: Hauptprüfung (z.B. zusammen mit 40% Klausur)</li>
                    <li><strong>40%</strong>: Zwischenprüfung</li>
                </ul>

                <h3 class="is-size-6 has-text-weight-semibold">Punktzahl</h3>
                <p>Die maximale Punktzahl legt fest, wie viele Punkte in dieser Prüfung maximal erreicht werden können.</p>

                <div class="notification is-info is-light">
                    <p class="is-size-7">
                        <span class="icon">
                            <i class="fas fa-lightbulb"></i>
                        </span>
                        <strong>Tipp:</strong> Alle Felder mit * sind Pflichtfelder.
                    </p>
                </div>
            </div>
        </div>

        {% if not exam %}
        <div class="box">
            <h2 class="subtitle">Beispiele</h2>

            <div class="content">
                <p class="is-size-7">Beispiele für Prüfungsnamen:</p>
                <ul class="is-size-7">
                    <li>Klausur Statistik I</li>
                    <li>Midterm Exam</li>
                    <li>Abschlussprüfung</li>
                    <li>Zwischenklausur</li>
                </ul>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
