{% extends "base.html" %}

{% block title %}Prüfungen - Dozentenmanager{% endblock %}

{% block breadcrumb %}
<section class="section pt-4 pb-0">
    <div class="container">
        <nav class="breadcrumb" aria-label="breadcrumbs">
            <ul>
                <li><a href="{{ url_for('index') }}">Home</a></li>
                <li class="is-active"><a href="#" aria-current="page">Prüfungen</a></li>
            </ul>
        </nav>
    </div>
</section>
{% endblock %}

{% block content %}
<div class="level">
    <div class="level-left">
        <div class="level-item">
            <h1 class="title">Prüfungen</h1>
        </div>
    </div>
    <div class="level-right">
        <div class="level-item">
            <a href="{{ url_for('exam.new') }}" class="button is-primary">
                <span class="icon">
                    <i class="fas fa-plus"></i>
                </span>
                <span>Neue Prüfung</span>
            </a>
        </div>
    </div>
</div>

<!-- Search and Filter Form -->
<div class="box">
    <form method="get" action="{{ url_for('exam.index') }}">
        <div class="field is-horizontal">
            <div class="field-body">
                <div class="field">
                    <div class="control is-expanded has-icons-left">
                        <input class="input" type="text" name="search" placeholder="Suche (Name)" value="{{ search_term }}">
                        <span class="icon is-left">
                            <i class="fas fa-search"></i>
                        </span>
                    </div>
                </div>
                <div class="field">
                    <div class="control is-expanded has-icons-left">
                        <div class="select is-fullwidth">
                            <select name="course_id">
                                <option value="">Alle Lehrveranstaltungen</option>
                                {% for course in courses %}
                                <option value="{{ course.id }}" {% if course_id|string == course.id|string %}selected{% endif %}>
                                    {{ course.name }} ({{ course.semester }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <span class="icon is-left">
                            <i class="fas fa-book"></i>
                        </span>
                    </div>
                </div>
                <div class="field">
                    <div class="control is-expanded has-icons-left">
                        <div class="select is-fullwidth">
                            <select name="exam_type">
                                <option value="">Alle Prüfungsarten</option>
                                <option value="midterm" {% if exam_type_filter == 'midterm' %}selected{% endif %}>Klausur (Mitte)</option>
                                <option value="final" {% if exam_type_filter == 'final' %}selected{% endif %}>Abschlussprüfung</option>
                                <option value="quiz" {% if exam_type_filter == 'quiz' %}selected{% endif %}>Test</option>
                                <option value="homework" {% if exam_type_filter == 'homework' %}selected{% endif %}>Hausaufgabe</option>
                                <option value="project" {% if exam_type_filter == 'project' %}selected{% endif %}>Projekt</option>
                            </select>
                        </div>
                        <span class="icon is-left">
                            <i class="fas fa-clipboard-check"></i>
                        </span>
                    </div>
                </div>
                <div class="field is-narrow">
                    <div class="control">
                        <button type="submit" class="button is-info">
                            <span class="icon">
                                <i class="fas fa-search"></i>
                            </span>
                            <span>Suchen</span>
                        </button>
                    </div>
                </div>
                {% if search_term or course_id or exam_type_filter %}
                <div class="field is-narrow">
                    <div class="control">
                        <a href="{{ url_for('exam.index') }}" class="button is-light">
                            <span class="icon">
                                <i class="fas fa-times"></i>
                            </span>
                            <span>Zurücksetzen</span>
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </form>
</div>

<!-- Exams Table -->
{% if exams %}
<div class="table-container">
    <table class="table is-fullwidth is-striped is-hoverable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Typ</th>
                <th>Lehrveranstaltung</th>
                <th>Maximalpunkte</th>
                <th>Gewicht</th>
                <th>Abgabedatum</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody>
            {% for exam in exams %}
            <tr>
                <td>
                    <a href="{{ url_for('exam.show', exam_id=exam.id) }}">
                        <strong>{{ exam.name }}</strong>
                    </a>
                </td>
                <td>
                    <span class="tag {% if exam.exam_type == 'final' %}is-danger{% elif exam.exam_type == 'midterm' %}is-warning{% elif exam.exam_type == 'quiz' %}is-info{% elif exam.exam_type == 'homework' %}is-success{% else %}is-primary{% endif %}">
                        {{ exam.exam_type }}
                    </span>
                </td>
                <td>
                    <a href="{{ url_for('course.show', course_id=exam.course.id) }}">
                        {{ exam.course.name }}
                    </a>
                    <br>
                    <small class="has-text-grey">{{ exam.course.semester }}</small>
                </td>
                <td>{{ exam.max_points }}</td>
                <td>{{ (exam.weight * 100)|int }}%</td>
                <td>
                    {% if exam.due_date %}
                        {{ exam.due_date.strftime('%d.%m.%Y') }}
                        <br>
                        <small class="has-text-grey">{{ exam.due_date.strftime('%H:%M') }}</small>
                    {% else %}
                        <span class="has-text-grey-light">Keine Frist</span>
                    {% endif %}
                </td>
                <td>
                    <div class="buttons are-small">
                        <a href="{{ url_for('exam.edit', exam_id=exam.id) }}" class="button is-small is-info">
                            <span class="icon is-small">
                                <i class="fas fa-edit"></i>
                            </span>
                        </a>
                        <form method="post" action="{{ url_for('exam.delete', exam_id=exam.id) }}" style="display: inline;" onsubmit="return confirm('Möchten Sie diese Prüfung wirklich löschen?');">
                            <button type="submit" class="button is-small is-danger">
                                <span class="icon is-small">
                                    <i class="fas fa-trash"></i>
                                </span>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="notification is-light">
    <p><strong>{{ exams|length }}</strong> Prüfung(en) gefunden</p>
</div>
{% else %}
<div class="notification is-warning">
    <p>Keine Prüfungen gefunden.</p>
    {% if search_term or course_id or exam_type_filter %}
    <p>Versuchen Sie, die Filter anzupassen.</p>
    {% else %}
    <p>Erstellen Sie eine neue Prüfung, um zu beginnen.</p>
    {% endif %}
</div>
{% endif %}
{% endblock %}
